language: generic
addons:
  ssh_known_hosts: mint.isi.edu
env:
  matrix:
  - DOCKER_COMPOSE_VERSION=1.23.2
  global:
  - secure: 5RKJIhE0OODPd6GlupCD6dUWJ6yZsoQ8ZRTrFN7pWuO0lEEuuHyhmmSm8aHlLikXBfyqOe+2EfZPDnjmLlz91IopzLhemaTQzp++HDK3EwKxcqF2gJwy7GswxV/X0+bMPbsxeFTEHQeaPUsvdSmhy66UyYVaRHuL7vxCuTaTcpU6pdM6ClJL7vxPSoMCfQcLOUuk2il0ofhWjj1w0S6RNIpoduwnBK+EUXlYv+SSd/pLsDrBmMXY0U7qMsaROtfsuJiNTdCmpdUgBPjjRMeDgTNRg/sHcdjsZ+baTyutEpuCNSuoM4otqa+pyD/fUhq56CDjVayQ/RQ/BYSeLX1yY3iEGHB2cx+cjTHAHlFdcpkJd2UL8JfbP6GvAFQj6cYag/FQTp+kjT/FaRr5FCBEeIHXUSMS2JPaj8CjqYXYqZT09BGLKJmV2SQ65rkyd50a4Ow3gJvJ2lnCY33ZxSpIlxMHeqEHZiWGeLowEPlz0DXu7XPWCJhTc7bJMuv3gz3HPN1/2r3tflmhN/VpekrBu1KPiU5I+xHasfGTMphr/lP/TqPTN83HvkAoMcW3SwBrU64519txz+DwxAn1fKcIO3jKHezntxQU93HyQEeVpqIhdF01UZg1tDYsjUsAL+6sOhO1aRlCtQnzf9v7II6zncwnoprl72DrYCbPoxuLJ5M=
services:
- docker
before_install:
- openssl aes-256-cbc -K $encrypted_af150e6bb5bf_key -iv $encrypted_af150e6bb5bf_iv
  -in google-api-key.ts.enc -out src/config/google-api-key.ts -d
- sudo rm /usr/local/bin/docker-compose
- curl -L https://github.com/docker/compose/releases/download/${DOCKER_COMPOSE_VERSION}/docker-compose-`uname
  -s`-`uname -m` > docker-compose
- chmod +x docker-compose
- sudo mv docker-compose /usr/local/bin
- docker-compose build
- docker-compose up -d prod
- docker cp $(docker-compose ps -q prod):/usr/share/nginx/html/ $TRAVIS_BUILD_DIR/model-catalog-explorer/
before_deploy:
- echo $key_pass | gpg --passphrase-fd 0 id_travis_rsa.gpg
- eval "$(ssh-agent -s)"
- chmod 600 id_travis_rsa
- ssh-add id_travis_rsa
deploy:
- provider: script
  skip_cleanup: true
  script: bash scripts/deploy.sh $TRAVIS_BUILD_DIR/model-catalog-explorer model-catalog_$TRAVIS_BRANCH
  on:
    all_branches: true
    condition: "$TRAVIS_BRANCH =~ ^(master)$"
- provider: script
  skip_cleanup: true
  script: bash scripts/deploy.sh $TRAVIS_BUILD_DIR/model-catalog-explorer model-catalog_$TRAVIS_TAG
  on:
    tags: true
    all_branches: true
