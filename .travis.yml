language: generic
addons:
  ssh_known_hosts:
  - mint.isi.edu
  - 54.148.90.74
env:
  matrix:
  - DOCKER_COMPOSE_VERSION=1.23.2
  global:
    secure: yG+O2pqt1imMOCkzbZGwA9Qlz19G7b0vfBJ4be4dnzW/F/qqHNxFYaqI3zGs8LzGyeUgmaHRE3dC15UMyAIxwkpOmlu5IoBE7Nzqhl9O2gB56T5dEZSp34ldc9SEFHIXnkS0MTggx6dyUwKdqkHSeZ1BMFK9fTlCzpd8IAKmVpnkFberkcu/ATN/SIWqAiMtORZruntQnbqUCwoblSN+ZJrUsHfxM20cnyE4reCrNfqWWcf9tvFHoiXDqvex4ZNCUiB1IH8DAiB8qE2CXPIeUEzxraxkSZcHkbc7mmNA87rcOrHynUc5EYsmDVRDSSqpMDO0JCSF86IUvXwvwB2GScfFpZ45m7h71GOE+t76OB734bm47QW4alZn4eXOK2/8c0vk4BILMS1rx5hL4YZ/IznnBV9qzps0pcQWOg1EeCzuOUiz6WG9r84Pcjgmt7vTpFnN/uqhnYxnrWBZcupnk95MV1JKtQOiS+/XoR2myJI+RyUaAD84jOASXXXuROzUe6nGxJF/GftLN8JnrnjqCM8O7tWM+J9fZpkTSozxW8zmwg3Dfnp3ueVi+2mHmG/zC3KF453YTtm7sRQn7p4ns9GvX3fyRjJl99sJejXp5Z3Q0PRG0ckDP+VAITf8LN+I7g8S3zNKjutmg6FZKU7hw8iHa7jbgnoO/YtREoQAiyE=
services:
- docker
before_install:
- openssl aes-256-cbc -K $encrypted_b0be83d31c08_key -iv $encrypted_b0be83d31c08_iv
  -in google-api-key.ts.enc -out src/config/google-api-key.ts -d
- sudo rm /usr/local/bin/docker-compose
- curl -L https://github.com/docker/compose/releases/download/${DOCKER_COMPOSE_VERSION}/docker-compose-`uname
  -s`-`uname -m` > docker-compose
- chmod +x docker-compose
- sudo mv docker-compose /usr/local/bin
- docker-compose build
- docker-compose up -d prod
- docker cp $(docker-compose ps -q prod):/usr/share/nginx/html/ $TRAVIS_BUILD_DIR/mint-ui-lit/
before_deploy:
- echo $key_pass | gpg --passphrase-fd 0 id_travis_rsa.gpg
- eval "$(ssh-agent -s)"
- chmod 600 id_travis_rsa
- ssh-add id_travis_rsa
deploy:
- provider: script
  skip_cleanup: true
  script: bash scripts/deploy.sh $TRAVIS_BUILD_DIR/mint-ui-lit mintui_$TRAVIS_BRANCH
  on:
    all_branches: true
    condition: "$TRAVIS_BRANCH =~ ^(master|dev|mint-demo|demo)$"
- provider: script
  skip_cleanup: true
  script: bash scripts/deploy.sh $TRAVIS_BUILD_DIR/mint-ui-lit mintui_$TRAVIS_TAG
  on:
    tags: true
    all_branches: true
